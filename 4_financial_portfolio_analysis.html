
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Use Case: Financial Portfolio Analysis &#8212; Agentic Prototyping</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = '4_financial_portfolio_analysis';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Use Case: Insurance Claim Processing" href="4_insurance_claims.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/ITRGLogoLightBlue.png" class="logo__image only-light" alt="Agentic Prototyping - Home"/>
    <script>document.write(`<img src="_static/ITRGLogoLightBlue.png" class="logo__image only-dark" alt="Agentic Prototyping - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Welcome to Agentic Prototyping
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Core Concepts</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="1_0_dev_quick_start.html">Developer Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="1_1_prompt_engineering.html">Prompt Engineering</a></li>
<li class="toctree-l1"><a class="reference internal" href="1_2_model_selection.html">Model Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="1_3_prototype_to_production.html">Prototype to Production</a></li>
<li class="toctree-l1"><a class="reference internal" href="1_4_structured_outputs.html">Structured Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="1_5_function_calling.html">Function calling</a></li>
<li class="toctree-l1"><a class="reference internal" href="1_6_conversational_state.html">Conversation state</a></li>
<li class="toctree-l1"><a class="reference internal" href="1_7_streaming.html">Streaming API responses</a></li>
<li class="toctree-l1"><a class="reference internal" href="1_8_file_inputs.html">File inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="1_9_image_generation.html">Image generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="1_10_text_to_speech.html">Text to speech</a></li>
<li class="toctree-l1"><a class="reference internal" href="1_11_speech_to_text.html">Speech to text</a></li>
<li class="toctree-l1"><a class="reference internal" href="1_12_embeddings.html">Vector embeddings</a></li>
<li class="toctree-l1"><a class="reference internal" href="1_13_retrieval.html">Retrieval</a></li>
<li class="toctree-l1"><a class="reference internal" href="1_14_evals.html">Evaluating model performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="1_15_moderation.html">Moderation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Agents</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="2_0_agents_overview.html">Agents Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="2_1_agent_design_foundations.html">Agent Design Foundations</a></li>
<li class="toctree-l1"><a class="reference internal" href="2_2_guardrails.html">Guardrails</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Best Practices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="3_0_production.html">Production best practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="3_1_safety.html">Safety Best Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="3_2_prompt_caching.html">Prompt caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="3_3_reasoning_models.html">Reasoning Best Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="3_4_accuracy_optimization.html">Optimizing LLM Accuracy</a></li>
<li class="toctree-l1"><a class="reference internal" href="3_5_reproducibility.html">Advanced usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="3_6_evaluation_design.html">Evals design best practices</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Case Studies</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="4_pharma_rd.html">Use Case: AI Co-Scientist for Pharma R&amp;D</a></li>
<li class="toctree-l1"><a class="reference internal" href="4_insurance_claims.html">Use Case: Insurance Claim Processing</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Use Case: Financial Portfolio Analysis</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/4_financial_portfolio_analysis.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Use Case: Financial Portfolio Analysis</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-you-ll-learn">What You’ll Learn</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-this-matters">Why this matters</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-multi-agent-collaboration">What is Multi-Agent Collaboration?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#collaboration-patterns-handoff-vs-agent-as-tool">Collaboration Patterns: Handoff vs. Agent-as-Tool</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#architecture-overview">Architecture Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#supported-tool-types">Supported Tool Types</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-workflow">Running the Workflow</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#breaking-down-the-head-portfolio-manager-agent">Breaking Down the Head Portfolio Manager Agent</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-this-design">Why This Design?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-we-implement-this-in-practice">How We Implement This in Practice</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#head-portfolio-manager-agent-code">Head Portfolio Manager Agent: Code</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-head-pm-system-prompt-enforcing-best-practices">The Head PM System Prompt: Enforcing Best Practices</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-output">Example Output</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-visualizations">Example Visualizations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#best-practices-when-building-agents">Best Practices When Building Agents</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="use-case-financial-portfolio-analysis">
<h1>Use Case: Financial Portfolio Analysis<a class="headerlink" href="#use-case-financial-portfolio-analysis" title="Link to this heading">#</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>This guide is for readers already familiar with OpenAI models and LLM agents, and want to see how to orchestrate a team of agents for a real-world, complex task.</p>
<section id="what-you-ll-learn">
<h3>What You’ll Learn<a class="headerlink" href="#what-you-ll-learn" title="Link to this heading">#</a></h3>
<p>In this notebook, you’ll learn how to use the OpenAI Agents SDK to design and implement a complex multi-agent collaboration system. Specifically, you’ll see how to:</p>
<ul class="simple">
<li><p>Build a workflow where multiple specialist agents (Macro, Fundamental, Quantitative) collaborate under a Portfolio Manager agent to solve a challenging investment research problem.</p></li>
<li><p>Use the “agents as a tool” approach, where a central agent orchestrates and calls other agents as tools for specific subtasks.</p></li>
<li><p>Leverage all major tool types supported by the SDK (custom Python functions, managed tools like Code Interpreter and WebSearch, and external MCP servers) in a single, integrated workflow.</p></li>
<li><p>Apply best practices for modularity, parallelism, and observability in agentic patterns.</p></li>
</ul>
</section>
<section id="why-this-matters">
<h3>Why this matters<a class="headerlink" href="#why-this-matters" title="Link to this heading">#</a></h3>
<p>The “agents as a tool” pattern is a powerful way to build transparent, auditable, and scalable multi-agent collaboration. This example demonstrates how to combine deep specialization, parallel execution, and robust orchestration using the OpenAI Agents SDK.</p>
<p>By the end of this guide, you’ll have a clear blueprint for building your own multi-agent workflows for research, analysis, or any complex task that benefits from expert collaboration.</p>
</section>
</section>
<hr class="docutils" />
<section id="what-is-multi-agent-collaboration">
<h2>What is Multi-Agent Collaboration?<a class="headerlink" href="#what-is-multi-agent-collaboration" title="Link to this heading">#</a></h2>
<p>Multi-agent collaboration means multiple autonomous agents (LLM “nodes”) coordinate to achieve an overarching goal that would be difficult for a single agent to handle. Instead of one monolithic prompt, each agent handles a specific subtask or expertise area, and an orchestration layer connects these agent “nodes” into a coherent workflow. This approach is useful for complex systems – for example, a financial analysis might be broken into macro-economic analysis, fundamental company analysis, and quantitative signal analysis, each handled by a different agent specialist. The agents share information and their results are combined to produce a final outcome.</p>
</section>
<hr class="docutils" />
<section id="collaboration-patterns-handoff-vs-agent-as-tool">
<h2>Collaboration Patterns: Handoff vs. Agent-as-Tool<a class="headerlink" href="#collaboration-patterns-handoff-vs-agent-as-tool" title="Link to this heading">#</a></h2>
<p>The OpenAI Agents SDK supports multiple patterns for agents to work together:</p>
<ul class="simple">
<li><p><strong>Handoff Collaboration:</strong> One agent can handoff control to another agent mid-problem. In a handoff architecture, each agent knows about the others and can decide when to defer to a more appropriate agent. This is flexible for open-ended or conversational workflows, but can make it harder to maintain a global view of the task. Read more in the SDK docs.</p></li>
<li><p><strong>Agent as a Tool:</strong> In this approach, one agent (often a central planner or manager) calls other agents as if they were tools. Sub-agents don’t take over the conversation; instead, the main agent invokes them for specific subtasks and incorporates their results. This model keeps a single thread of control (the main agent orchestrates everything) and tends to simplify coordination. This repo uses the agent-as-tool model: the Portfolio Manager agent remains in charge, using the other specialist agents as tools when it needs their expertise. This choice keeps the overall reasoning transparent and allows parallel execution of sub-tasks, which is ideal for complex analyses.</p></li>
</ul>
<p>For more on these collaboration patterns, see the OpenAI Agents SDK documentation.</p>
</section>
<hr class="docutils" />
<section id="architecture-overview">
<h2>Architecture Overview<a class="headerlink" href="#architecture-overview" title="Link to this heading">#</a></h2>
<p>Our system follows a hub-and-spoke design. The Portfolio Manager agent is the hub (central coordinator), and the specialist agents are the spokes. The user’s query (e.g. “How would a planned interest rate reduction affect my GOOGL holdings?”) goes first to the Portfolio Manager. The Portfolio Manager agent is prompted to break down the problem and delegate to the appropriate specialist agents. It treats each specialist as a callable tool, invoking them for their portion of the analysis. All three report back to the Portfolio Manager, which then synthesizes a final answer for the user.</p>
<p><img alt="Multi-Agent Collaboration Architecture" src="_images/multi_agent_collab_agent_architecture.png" /></p>
</section>
<hr class="docutils" />
<section id="supported-tool-types">
<h2>Supported Tool Types<a class="headerlink" href="#supported-tool-types" title="Link to this heading">#</a></h2>
<p>A key advantage of the Agents SDK is the flexibility in defining tools that agents can use. Tools can range from simple Python functions to external services. In this project, we use:</p>
<ul class="simple">
<li><p><strong>MCP (Model Context Protocol) Server:</strong> Used to connect agents to external tools and data sources in a standardized way. This project uses a local MCP server for Yahoo Finance data (see <code class="docutils literal notranslate"><span class="pre">mcp/yahoo_finance_server.py</span></code>). Learn more: OpenAI MCP docs | MCP Spec</p></li>
<li><p><strong>OpenAI Managed Tools:</strong> Managed tools are built-in, hosted tools provided by OpenAI that require no custom implementation. They offer powerful capabilities out of the box, such as Code Interpreter (for quantitative/statistical analysis) and WebSearch (for up-to-date news and data).</p></li>
<li><p><strong>Custom Tools:</strong> Custom tools are any Python functions you define and register as tools for your agent. The Agents SDK makes this easy: just decorate your function, and the SDK will automatically extract its name, docstring, and input schema. This is ideal for domain-specific logic, data access, or workflow extensions.</p></li>
</ul>
<p>Want to add more tools? The SDK supports a wide range of tool types, including web search, file search, code execution, and more. See the full list of supported tools in the SDK documentation.</p>
</section>
<hr class="docutils" />
<section id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Link to this heading">#</a></h2>
<p>Install required dependencies:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>!pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt
</pre></div>
</div>
<p>Before running the workflow, set your environment variables:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">OPENAI_API_KEY</span></code> (for OpenAI access)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FRED_API_KEY</span></code> (for FRED economic data, see FRED API key instructions)</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="n">missing</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OPENAI_API_KEY&#39;</span><span class="p">):</span>
    <span class="n">missing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;OPENAI_API_KEY&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FRED_API_KEY&#39;</span><span class="p">):</span>
    <span class="n">missing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;FRED_API_KEY&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing environment variable(s): </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span><span class="si">}</span><span class="s2">. Please set them before running the workflow.&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All required API keys are set.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="running-the-workflow">
<h2>Running the Workflow<a class="headerlink" href="#running-the-workflow" title="Link to this heading">#</a></h2>
<p>Edit the question to whatever you’d like, but keep the date field to improve accuracy!</p>
<blockquote>
<div><p><strong>Disclaimer:</strong> This example is for educational purposes only. Consult a qualified financial professional before making any investment decisions.</p>
</div></blockquote>
<p>The workflow is kicked off by sending a user request to the Head Portfolio Manager (PM) agent. The PM agent orchestrates the entire process, delegating to specialist agents and tools as needed. You can monitor the workflow in real time using OpenAI Traces, which provide detailed visibility into every agent and tool call.</p>
<p><strong>Note:</strong> Depending on the complexity of the task, this request can take up to 10 minutes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">contextlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncExitStack</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agents</span><span class="w"> </span><span class="kn">import</span> <span class="n">Runner</span><span class="p">,</span> <span class="n">add_trace_processor</span><span class="p">,</span> <span class="n">trace</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agents.tracing.processors</span><span class="w"> </span><span class="kn">import</span> <span class="n">BatchTraceProcessor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">FileSpanExporter</span><span class="p">,</span> <span class="n">output_file</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">investment_agents.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">build_investment_agents</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>

<span class="n">add_trace_processor</span><span class="p">(</span><span class="n">BatchTraceProcessor</span><span class="p">(</span><span class="n">FileSpanExporter</span><span class="p">()))</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run_workflow</span><span class="p">():</span>
    <span class="k">if</span> <span class="s2">&quot;OPENAI_API_KEY&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="s2">&quot;OPENAI_API_KEY not set — set it as an environment variable before running.&quot;</span><span class="p">)</span>

    <span class="n">today_str</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%B </span><span class="si">%d</span><span class="s2">, %Y&quot;</span><span class="p">)</span>
    <span class="n">question</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Today is </span><span class="si">{</span><span class="n">today_str</span><span class="si">}</span><span class="s2">. &quot;</span>
        <span class="s2">&quot;How would the planned interest rate reduction effect my holdings in GOOGL if they were to happen?&quot;</span>
        <span class="s2">&quot;Considering all the factors effecting its price right now (Macro, Technical, Fundamental, etc.), what is a realistic price target by the end of the year?&quot;</span>
    <span class="p">)</span>
    <span class="n">bundle</span> <span class="o">=</span> <span class="n">build_investment_agents</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncExitStack</span><span class="p">()</span> <span class="k">as</span> <span class="n">stack</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">bundle</span><span class="p">,</span> <span class="s2">&quot;fundamental&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">bundle</span><span class="p">,</span> <span class="s2">&quot;quant&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]:</span>
            <span class="k">if</span> <span class="n">agent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">server</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="s2">&quot;mcp_servers&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="k">await</span> <span class="n">server</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
                <span class="k">await</span> <span class="n">stack</span><span class="o">.</span><span class="n">enter_async_context</span><span class="p">(</span><span class="n">server</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Running multi-agent workflow with tracing enabled...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">trace</span><span class="p">(</span>
            <span class="s2">&quot;Investment Research Workflow&quot;</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;question&quot;</span><span class="p">:</span> <span class="n">question</span><span class="p">[:</span><span class="mi">512</span><span class="p">]}</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">workflow_trace</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">🔗 View the trace in the OpenAI console: &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;https://platform.openai.com/traces/trace?trace_id=</span><span class="si">{</span><span class="n">workflow_trace</span><span class="o">.</span><span class="n">trace_id</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>

            <span class="n">response</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span>
                    <span class="n">Runner</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">bundle</span><span class="o">.</span><span class="n">head_pm</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="n">max_turns</span><span class="o">=</span><span class="mi">40</span><span class="p">),</span>
                    <span class="n">timeout</span><span class="o">=</span><span class="mi">1200</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">❌ Workflow timed out after 20 minutes.&quot;</span><span class="p">)</span>

            <span class="n">report_path</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s1">&#39;final_output&#39;</span><span class="p">):</span>
                    <span class="n">output</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">final_output</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;file&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                            <span class="n">report_path</span> <span class="o">=</span> <span class="n">output_file</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not parse investment report path: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Workflow Completed Response from Agent: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">final_output</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">hasattr</span><span class="p">(</span><span class="n">response</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;final_output&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">response</span><span class="si">}</span><span class="s2">, investment report created: </span><span class="si">{</span><span class="n">report_path</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">report_path</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;[unknown]&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># In a Jupyter notebook cell, run:</span>
<span class="k">await</span> <span class="n">run_workflow</span><span class="p">()</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="breaking-down-the-head-portfolio-manager-agent">
<h2>Breaking Down the Head Portfolio Manager Agent<a class="headerlink" href="#breaking-down-the-head-portfolio-manager-agent" title="Link to this heading">#</a></h2>
<p>The Head Portfolio Manager (PM) agent is the orchestrator of the entire workflow. It coordinates a set of four specialist agents, each focused on a different area of expertise. This design is intentional: overloading a single agent with every possible responsibility leads to shallow, generic outputs and makes it hard to maintain or improve your system over time.</p>
<section id="why-this-design">
<h3>Why This Design?<a class="headerlink" href="#why-this-design" title="Link to this heading">#</a></h3>
<p>By breaking the problem into specialized agents—each with a clear role—you get:</p>
<ul class="simple">
<li><p><strong>Deeper, higher-quality research:</strong> Each agent can focus on its domain, using the right tools and prompts for the job. The PM agent brings these perspectives together for a more nuanced, robust answer.</p></li>
<li><p><strong>Modularity and clarity:</strong> You can update, test, or improve one agent without affecting the others. This makes your system easier to maintain and extend as your needs evolve.</p></li>
<li><p><strong>Faster results through parallelism:</strong> Independent agents can work at the same time, dramatically reducing the time to complete complex, multi-part analyses.</p></li>
<li><p><strong>Consistency and auditability:</strong> A structured, prompt-driven workflow ensures every run follows best practices, is easy to debug, and produces outputs you can trust and review.</p></li>
</ul>
<p>This approach is ideal for any application where you want depth, specialization, and reliability—whether you’re building a research assistant, a decision support tool, or any system that benefits from expert collaboration and orchestration.</p>
</section>
<hr class="docutils" />
<section id="how-we-implement-this-in-practice">
<h3>How We Implement This in Practice<a class="headerlink" href="#how-we-implement-this-in-practice" title="Link to this heading">#</a></h3>
<p>Each specialist agent (Fundamental, Macro, Quantitative) is wrapped as a callable tool using the SDK’s <code class="docutils literal notranslate"><span class="pre">function_tool</span></code> decorator, with custom names and descriptions. This makes the PM agent’s toolset explicit and LLM-friendly.</p>
<p>The Head PM agent uses the <code class="docutils literal notranslate"><span class="pre">run_all_specialists_parallel</span></code> tool to invoke all three specialists concurrently, leveraging <code class="docutils literal notranslate"><span class="pre">parallel_tool_calls=True</span></code> for maximum speed and efficiency.</p>
<p>The agent’s prompt is loaded from a markdown file (<code class="docutils literal notranslate"><span class="pre">pm_base.md</span></code>), encoding not just the firm’s philosophy but also detailed tool usage rules and a step-by-step workflow. This ensures every run is consistent, auditable, and aligned with best practices.</p>
<p>After gathering and reviewing the specialist outputs, the PM agent uses a dedicated memo editor tool to assemble, format, and finalize the investment report. This separation of concerns keeps the workflow modular and easy to extend.</p>
<p>The system is designed for extensibility: you can add new specialist agents, swap out tools, or update prompts without breaking the overall orchestration logic. All tool calls, agent decisions, and outputs are captured in OpenAI Traces for full transparency and debugging.</p>
</section>
<hr class="docutils" />
<section id="head-portfolio-manager-agent-code">
<h3>Head Portfolio Manager Agent: Code<a class="headerlink" href="#head-portfolio-manager-agent-code" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">agents</span><span class="w"> </span><span class="kn">import</span> <span class="n">Agent</span><span class="p">,</span> <span class="n">ModelSettings</span><span class="p">,</span> <span class="n">function_tool</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_prompt</span><span class="p">,</span> <span class="n">DISCLAIMER</span>

<span class="k">def</span><span class="w"> </span><span class="nf">build_head_pm_agent</span><span class="p">(</span><span class="n">fundamental</span><span class="p">,</span> <span class="n">macro</span><span class="p">,</span> <span class="n">quant</span><span class="p">,</span> <span class="n">memo_edit_tool</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">make_agent_tool</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="p">):</span>
        <span class="nd">@function_tool</span><span class="p">(</span><span class="n">name_override</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">description_override</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>
        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">agent_tool</span><span class="p">(</span><span class="nb">input</span><span class="p">):</span>
            <span class="k">return</span> <span class="k">await</span> <span class="n">specialist_analysis_func</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="nb">input</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">agent_tool</span>
    <span class="n">fundamental_tool</span> <span class="o">=</span> <span class="n">make_agent_tool</span><span class="p">(</span><span class="n">fundamental</span><span class="p">,</span> <span class="s2">&quot;fundamental_analysis&quot;</span><span class="p">,</span> <span class="s2">&quot;Generate the Fundamental Analysis section.&quot;</span><span class="p">)</span>
    <span class="n">macro_tool</span> <span class="o">=</span> <span class="n">make_agent_tool</span><span class="p">(</span><span class="n">macro</span><span class="p">,</span> <span class="s2">&quot;macro_analysis&quot;</span><span class="p">,</span> <span class="s2">&quot;Generate the Macro Environment section.&quot;</span><span class="p">)</span>
    <span class="n">quant_tool</span> <span class="o">=</span> <span class="n">make_agent_tool</span><span class="p">(</span><span class="n">quant</span><span class="p">,</span> <span class="s2">&quot;quantitative_analysis&quot;</span><span class="p">,</span> <span class="s2">&quot;Generate the Quantitative Analysis section.&quot;</span><span class="p">)</span>

    <span class="nd">@function_tool</span><span class="p">(</span><span class="n">name_override</span><span class="o">=</span><span class="s2">&quot;run_all_specialists_parallel&quot;</span><span class="p">,</span> <span class="n">description_override</span><span class="o">=</span><span class="s2">&quot;Run all three specialist analyses (fundamental, macro, quant) in parallel and return their results as a dict.&quot;</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run_all_specialists_tool</span><span class="p">(</span><span class="n">fundamental_input</span><span class="p">,</span> <span class="n">macro_input</span><span class="p">,</span> <span class="n">quant_input</span><span class="p">):</span>
        <span class="k">return</span> <span class="k">await</span> <span class="n">run_all_specialists_parallel</span><span class="p">(</span>
            <span class="n">fundamental</span><span class="p">,</span> <span class="n">macro</span><span class="p">,</span> <span class="n">quant</span><span class="p">,</span>
            <span class="n">fundamental_input</span><span class="p">,</span> <span class="n">macro_input</span><span class="p">,</span> <span class="n">quant_input</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">Agent</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Head Portfolio Manager Agent&quot;</span><span class="p">,</span>
        <span class="n">instructions</span><span class="o">=</span><span class="p">(</span><span class="n">load_prompt</span><span class="p">(</span><span class="s2">&quot;pm_base.md&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">DISCLAIMER</span><span class="p">),</span>
        <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4.1&quot;</span><span class="p">,</span>
        <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">fundamental_tool</span><span class="p">,</span> <span class="n">macro_tool</span><span class="p">,</span> <span class="n">quant_tool</span><span class="p">,</span> <span class="n">memo_edit_tool</span><span class="p">,</span> <span class="n">run_all_specialists_tool</span><span class="p">],</span>
        <span class="n">model_settings</span><span class="o">=</span><span class="n">ModelSettings</span><span class="p">(</span><span class="n">parallel_tool_calls</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tool_choice</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="the-head-pm-system-prompt-enforcing-best-practices">
<h2>The Head PM System Prompt: Enforcing Best Practices<a class="headerlink" href="#the-head-pm-system-prompt-enforcing-best-practices" title="Link to this heading">#</a></h2>
<p>The PM agent’s system prompt (see <code class="docutils literal notranslate"><span class="pre">prompts/pm_base.md</span></code>) is the heart of the workflow. It encodes:</p>
<ul class="simple">
<li><p>The firm’s philosophy (originality, risk awareness, challenging consensus)</p></li>
<li><p>Clear tool usage rules (when to use parallel tools, how to structure inputs)</p></li>
<li><p>A robust, multi-step workflow (determine task type, provide guidance, review outputs, assemble memo, handle missing data)</p></li>
</ul>
<p>This prompt ensures that every run is:</p>
<ul class="simple">
<li><p><strong>Consistent:</strong> The same high standards and process are followed every time.</p></li>
<li><p><strong>Auditable:</strong> Each step, tool call, and decision is visible in the trace.</p></li>
<li><p><strong>High-Quality:</strong> Outputs are original, risk-aware, and rigorously reviewed.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">Markdown</span><span class="p">,</span> <span class="n">display</span>

<span class="n">pm_prompt_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;prompts/pm_base.md&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">pm_prompt_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">pm_prompt_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="n">content</span><span class="p">))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;System prompt not found at prompts/pm_base.md&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="example-output">
<h2>Example Output<a class="headerlink" href="#example-output" title="Link to this heading">#</a></h2>
<p>Here’s an example of an investment report generated through the workflow. Your output will be written to the outputs folder in the directory.</p>
<details>
<summary>Click to expand Investment Memo</summary>
<p><em>Investment Memo: Alphabet Inc. (GOOGL) – Impact of Planned Interest Rate Reduction (May 2025)</em></p>
<!-- (Insert the full memo text here as in your original content) -->
</details>
</section>
<hr class="docutils" />
<section id="example-visualizations">
<h2>Example Visualizations<a class="headerlink" href="#example-visualizations" title="Link to this heading">#</a></h2>
<!-- Insert the following images in the appropriate order for your analysis. -->
<p><img alt="Cumulative Return Comparison" src="_images/multi_agent_collab_cumulative_return_comparison.png" />
<img alt="GOOGL Daily Returns" src="_images/multi_agent_collab_googl_daily_returns.png" />
<img alt="GOOGL Moving Averages" src="_images/multi_agent_collab_googl_moving_averages.png" />
<img alt="GOOGL Rolling Volatility" src="_images/multi_agent_collab_googl_rolling_volatility.png" />
<img alt="Rolling Volatility Comparison" src="_images/multi_agent_collab_rolling_volatility_comparison.png" />
<img alt="GOOGL Quarterly Margins" src="_images/multi_agent_collab_GOOGL_quarterly_margins.png" />
<img alt="GOOGL Quarterly Trends" src="_images/multi_agent_collab_GOOGL_quarterly_trends.png" />
<img alt="GOOGL RSI" src="_images/multi_agent_collab_googl_rsi.png" />
<img alt="GOOGL Analyst Recommendations Trend" src="_images/multi_agent_collab_GOOGL_analyst_recommendations_trend.png" /></p>
</section>
<hr class="docutils" />
<section id="best-practices-when-building-agents">
<h2>Best Practices When Building Agents<a class="headerlink" href="#best-practices-when-building-agents" title="Link to this heading">#</a></h2>
<p>The most effective agentic systems combine modular agent design, clear tool definitions, parallel execution, and structured prompts. This approach—central to the OpenAI Agents SDK—makes your workflows robust, scalable, and easy to debug or extend.</p>
<p><strong>Key features of the OpenAI Agents SDK that enable these best practices:</strong></p>
<ul class="simple">
<li><p>Agent loop: Handles tool calls, LLM reasoning, and workflow control automatically.</p></li>
<li><p>Python-first orchestration: Use familiar Python patterns to chain, compose, and orchestrate agents.</p></li>
<li><p>Handoffs: Delegate tasks between agents for specialization and modularity.</p></li>
<li><p>Guardrails: Validate inputs/outputs and break early on errors for reliability.</p></li>
<li><p>Function tools: Register any Python function as a tool, with automatic schema and validation.</p></li>
<li><p>Tracing: Visualize, debug, and monitor every step of your workflow for full transparency.</p></li>
</ul>
<p>A combination of well-designed tools, thoughtful orchestration, and careful model selection is crucial for building effective agent systems. In this example, we use the GPT-4.1 family of models for their strong analytical and tool-use capabilities (see the GPT-4.1 Prompting Guide). For deeper architectural best practices, see the included A Practical Guide to Building Agents (PDF). By bringing these elements together, you get a system that is robust, scalable, and easy to debug or extend.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="4_insurance_claims.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Use Case: Insurance Claim Processing</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-you-ll-learn">What You’ll Learn</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-this-matters">Why this matters</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-multi-agent-collaboration">What is Multi-Agent Collaboration?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#collaboration-patterns-handoff-vs-agent-as-tool">Collaboration Patterns: Handoff vs. Agent-as-Tool</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#architecture-overview">Architecture Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#supported-tool-types">Supported Tool Types</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-workflow">Running the Workflow</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#breaking-down-the-head-portfolio-manager-agent">Breaking Down the Head Portfolio Manager Agent</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-this-design">Why This Design?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-we-implement-this-in-practice">How We Implement This in Practice</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#head-portfolio-manager-agent-code">Head Portfolio Manager Agent: Code</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-head-pm-system-prompt-enforcing-best-practices">The Head PM System Prompt: Enforcing Best Practices</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-output">Example Output</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-visualizations">Example Visualizations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#best-practices-when-building-agents">Best Practices When Building Agents</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book Community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>